University: ITMO University
Faculty: FICT
Course: Network programming
Year: 2022
Group: K34212
Автор: Телегина Екатерина Олеговна
Lab: Lab1
Тема работы: Установка CHR и Ansible, настройка VPN
 
Цель работы: 
•	развернуть виртуальную машину с установленной системой контроля конфигураций Ansible;
•	установить Mikrotik RouterOS в VirtualBox;
•	установка VPN туннеля между машиной Ubuntu и RouterOS.

Ход работы:
Сначала создаем виртуальную машину Ubuntu на Яндекс Облаке. Затем устанавливаем python3 и Ansible с помощью команд:
•	sudo apt install python3-pip
•	sudo pip3 install ansible

Подключаемся к этой виртуальной машине по ssh ключу.
 


Устанавливаем MikroTik 7 версии в VirtualBox. После загрузки отключаем загрузочный диск вручную в настройках VirtualBox, поскольку этого не происходит происходит автоматически.

Теперь создадим WireGuard сервер на удаленной машине Ubuntu (VPN сервер).
•	Для установки используем команду - sudo apt install wireguard;
•	Прописываем в WireGuard файл условий интерфейса;
•	Создаем пару ssh ключей.

Поставили графический интерфейс WinBox. Подключаемся к виртуальной машине MikroTik.
 

Заходим в настройки Wireguard и создаем новый интерфейс и заполняем строки (ListenPort узнаём командой вывода файла /etc/wireguard/wg0.conf на сервере).
 

Открываем Wireguard Peer и указываем созданный на предыдущем шаге интерфейс (Interface), публичный ключ сервера (Public Key), публичный IP (Endpoint), порт (Endpoint Port), адрес, по которому будет идти подключение (Allowed Address).
 

Во вкладке Addresses указываем выбранную сеть (192.168.6.67/24) и интерфейс (wireguard1).
 

Во вкладке Firewall создаем NAT Rule masquerade, что позволит нам преобразовывать несколько IP-адресов в другой одиночный IP-адрес. 
 

Теперь пингуем виртуальную машину по заданному IP адресу. Ping идет успешно, а значит все настройки выполнены правильно.
 

В результате получаем связь по следующей схеме. 
 
Вывод: в ходе выполнения лабораторной работы мы научились устанавливать систему Ansible, устанавливать Mikrotik RouterOS в VirtualBox, а также смогли создать VPN туннель между виртуальной машиной Ubuntu и удаленной виртуальной машиной при помощи WireGuard.

